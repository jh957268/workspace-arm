<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Untitled Document</title>
<link rel=stylesheet href="style.css" type="text/css" />
</head>

<body id="antenna">
<div id="result"></div>
<form action="wan.htm" method="get">
 <table cellspacing="0" cellpadding="0">
	<tr>
    	<td class="head" colspan="2">&nbsp;&nbsp;Item-Level Tracking Made Easy...</td>
    </tr>
	<tr>
    	<td colspan="2" class="pgtitle">iReader-989 WEB GUI Version 1.0.0.0</td>
    </tr>
    <tr>
    	<td valign="top">
        	<ul>
            <li><a href="sysinfo.html" id="sysinfo">System</a></li>
            <li><a href="antenna.html" id="antenna">Antenna Status</a></li>
            <li><a href="taginfo.html" id="taginfo">Read Tags</a></li>
            <li><a href="tagdb.html" id="tagdb">Database Tags</a></li>
			<li><a href="asset.html" id="asset">Asset Monitoring</a></li>
			<li><a href="network.html" id="network">Network Settings</a></li>			
            </ul>
        </td>
        <td>
        	<table class="b" id="ant_table" cellspacing="0" cellpadding="0">
            	<tr>
                	<th colspan="16">Connected Antennas/Output Power(dBm)</th>
				</tr>		
            </table>
        	<table class="b" cellspacing="0" cellpadding="0">
				<tr>			
					<td>
						<input type=button style="{width:120px;}" value="Refresh List" onClick="ProcessRefreshList()" />
						<input type=button style="{width:120px;}" value="Rescan Channel" onClick="ProcessRescanChannel()" />
						<select id="chanId" size="1">
							<option value="1">1</option>
							<option value="2">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8">8</option>
							<option value="9">All</option>	
						</select>						
					</td>
					<td>
						<label for="anten"><b>AntID:</b></label>
						<input type="text" name="anten" id="AntID" value="1" size="4" />
						<label for="power"><b>&nbsp;Power:</b></label>
						<select id="powerId" size="1">
							<option value="10">10dBm</option>
							<option value="11">11dBm</option>
							<option value="12">12dBm</option>
							<option value="13">13dBm</option>
							<option value="14">14dBm</option>
							<option value="15">15dBm</option>
							<option value="16">16dBm</option>
							<option value="17">17dBm</option>
							<option value="18">18dBm</option>
							<option value="19">19dBm</option>
							<option value="20">20dBm</option>
							<option value="21">21dBm</option>
							<option value="22">22dBm</option>
							<option value="23">23dBm</option>
							<option value="24">24dBm</option>
							<option value="25" selected>25dBm</option>
							<option value="26">26dBm</option>
							<option value="27">27dBm</option>
							<option value="28">28dBm</option>
							<option value="29">29dBm</option>
							<option value="30">30dBm</option>							
						</select>
						<input type=button style="width:120px" value="Set Ant. Power" style="color:black" onClick="ProcessSetAntPower(this.form)" />						
					</td>
                </tr>			
             </table>			
        </td>
    </tr>
</table>
</form>

<script>

function ProcessSetAntPower(thform)
{
	var xhttp = new XMLHttpRequest();
  	xhttp.onreadystatechange = function() {
    	if (this.readyState == 4 && this.status == 200) {
			//document.getElementById("result").innerHTML = this.responseText;
			alert("Set Power " + this.responseText);
    	}
  	}
	var antid;
	antid = thform.anten.value;
	var e = document.getElementById("powerId");
	var power = e.options[e.selectedIndex].value;

	//alert(antid + power);
  	xhttp.open("GET", "cgi-bin/execgi-bin.cgi?setpower1-"+antid+"-"+power+"00", true);
  	xhttp.send();
}

function ProcessRefreshList()
{
	loadAntennaMap();
}

function ProcessRescanChannel()
{
	var xhttp = new XMLHttpRequest();
  	xhttp.onreadystatechange = function() {
    	if (this.readyState == 4 && this.status == 200) {
			//document.getElementById("result").innerHTML = this.responseText;
			alert("Set Power " + this.responseText);
    	}
  	}

	var e = document.getElementById("chanId");
	var value = e.options[e.selectedIndex].value;

	//alert(value);
  	xhttp.open("GET", "cgi-bin/execgi-bin.cgi?rescanchn-"+value, true);
  	xhttp.send();
}

 function loadDoc()
 { 
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      document.getElementById("myHeader").value =
      this.responseText;
    }
  };
  xhttp.open("GET", "cgi-bin/rfid_test.cgi?s=C&o=1", true);
  xhttp.send();


  var xhttp1 = new XMLHttpRequest();
  xhttp1.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      document.getElementById("myHeader1").value =
      this.responseText;
    }
  };
  xhttp1.open("GET", "cgi-bin/rfid_test1.cgi?s=C&o=1", true);
  xhttp1.send();
 }

 function loadField(url, id)
 { 
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      document.getElementById(id).value =
      this.responseText;
    }
  };
  xhttp.open("GET", url, true);
  xhttp.send();
 }
 //alert("Table  find!");
//loadField('cgi-bin/rfid_test.cgi', 'myHeader');
//loadField('cgi-bin/rfid_test1.cgi', 'myHeader1');

 //var tbl_idx = 1;
 //alert("Table  find1!");
 
function displayAntennaMap(response)
{
	var atable = document.getElementById("ant_table");
	var trow;
	var cell;
	var cell_idx = 0;
	var msg;
	var ant_id;
	var pwr;
	
	const [antstr, pwrstr] = response.split('~');
	var pwrarr = pwrstr.split(/[;]/);
	for (tbl_row = 2; tbl_row <= 17; tbl_row++)
	{
		if (typeof atable.rows[tbl_row] != 'undefined' )
		{
			for (i = 0; i< 16; i++)
			{
				cell = atable.rows[tbl_row].cells[i];
				ant_id = cell_idx+1;
				msg = '<b>-'+ant_id+'</b>';
				pwr = '<br><b>'+ pwrarr[cell_idx] + '</b>';
				cell.innerHTML = '&#128225;'+msg+pwr;
				if (antstr.charAt(cell_idx) == '1')
				{
					cell.style.backgroundColor = "#7CFC00";
				}
				else
				{
					cell.style.backgroundColor = "#eeeedd";			
				}
				cell_idx++;				
			}		
		}
		else
		{
			trow = atable.insertRow(tbl_row);
			//if ( tbl_row == 0 || (tbl_row && !(tbl_row%2)))
			//{
			//	trow.style.backgroundColor = "#cbccc6";
			//}
			//else
			//{
			//	trow.style.backgroundColor = "#DFEFE9";	
			//}

			for (i = 0; i< 16; i++)
			{
				cell = trow.insertCell(i);
				ant_id = cell_idx+1;
				msg = '<b>-'+ant_id+'</b>';
				pwr = '<br><b>'+ pwrarr[cell_idx] + '</b>';
				cell.innerHTML = '&#128225;'+msg+pwr;
				if (antstr.charAt(cell_idx) == '1')
				{
					cell.style.backgroundColor = "#7CFC00";
				}
				else
				{
					cell.style.backgroundColor = "#eeeedd";			
				}
				cell_idx++;
			}
		}
	}
}

 function loadAntennaMap()
 { 
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
		//document.getElementById("result").innerHTML = this.responseText;
      displayAntennaMap(this.responseText);
    }
  }
  xhttp.open("GET", "cgi-bin/execgi-bin.cgi?antmap=1", true);
  xhttp.send();
 }

  var tablea = document.getElementById("ant_table");
  if (tablea )
  { 
    //alert("Table found!");
  }
  else
  {
    alert("Table not found!");
  }
  
  var row;
  var cell0;
  var tbl_idx = 1;
  row = tablea.insertRow(tbl_idx);
  if ( tbl_idx == 0 || (tbl_idx && !(tbl_idx%2)))
  {
	row.style.backgroundColor = "#cbccc6";
  }
  else
  {
	row.style.backgroundColor = "#DFEFE9";	
  } 
  for (i = 0; i< 16; i++)
  {
	cell0 = row.insertCell(i);
	cell0.innerHTML = i+1;
		//cell1.innerHTML = 'JOO1 Test';
		//cell2.innerHTML = 'JOO2 Test';
		//cell3.innerHTML = 'JOO3 Test';
  }  
  // tablea.rows[5].cells[10].innerHTML='&#128225;<b>ANT</b>';
  //alert("Table row inserted end!");
  loadAntennaMap();
  //displayAntennaMap('00000000111111110101010101010101~25;26;27;28;29;30;31;32;25;26;27;28;29;30;31;32;25;26;27;28;29;30;31;32;25;26;27;28;29;30;31;32;');
</script>

</body>
</html>

