<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Untitled Document</title>
<link rel=stylesheet href="style-joo.css" type="text/css" />
</head>

<body id="lan">

<form action="wan.htm" method="get">
 <table cellspacing="0" cellpadding="0">
	<tr>
    	<td class="head" colspan="2">&nbsp;&nbsp;Item-Level Tracking Made Easy...</td>
    </tr>
	<tr>
    	<td colspan="2" class="pgtitle">iReader-989 WEB GUI 1.0.0.0</td>
    </tr>
    <tr>
    	<td valign="top">
        	<ul>
            <li><a href="lan.htm" id="lan">System</a></li>
            <li><a href="wan.htm" id="wan">WAN/Internet</a></li>
            <li><a href="" id="password">Password</a></li>
            <li><a href="" id="dhcpserver">DHCP Server</a></li>
            <li><a href="" id="portforwarding">Port Forwarding</a></li>
            <li><a href="" id="ddns">DDNS</a></li>
            <li><a href="" id="systeminfo">System Info</a></li>
            <li><a href="" id="logs">Logs</a></li>
            <li><a href="" id="savesettings">Save Settings</a></li>
            <li><a href="" id="reboot">Reboot</a></li>
            </ul>
        </td>
        <td>
        	<table class="b" id="ant_table" cellspacing="0" cellpadding="0">
            	<tr>
                	<th style="width:10%">Tag No.</th>
					<th style="width:50%">EPC Data</th>
					<th style="width:30%">Last Seen Time</th>
					<th style="width:20%">Count</th>					
				</tr>		
            </table>
        	<table class="b" cellspacing="0" cellpadding="0">
				<tr>			
					<td colspan="4">
						<input type=button style="{width:120px;}" value="Start Tag Read" onClick="startTagInfoSSe()" />
						<input type=button style="{width:120px;}" value="Stop Tag Read" onClick="stopTagInfoSSe()" />
						<input type=button style="{width:120px;}" value="Tag Read Once" onClick="readTagInfoOnce()" />
					</td>
                </tr>			
             </table>			
        </td>
    </tr>
</table>
</form>

<script>

var tagCount = 0; 
function displayTagInfo(tagInfo)
{
	var atable = document.getElementById("ant_table");
	var trow;
	var cell;
	
	const [epcData, timeSeen] = tagInfo.split('~');
 
	for (tbl_row = 1; tbl_row <= tagCount; tbl_row++)
	{
		if ( atable.rows[tbl_row].cells[1].innerHTML.localeCompare(epcData) == 0)
		{
			atable.rows[tbl_row].cells[2].innerHTML = timeSeen;
			
			var cnt = 1*atable.rows[tbl_row].cells[3].innerHTML;
			cnt = cnt+1;
			atable.rows[tbl_row].cells[3].innerHTML = cnt;
			return;
		}
	}
	// for (tbl_row = 1; tbl_row <= 2; tbl_row++)
	tbl_row = tagCount + 1;
	{
		trow = atable.insertRow(tbl_row);
		if ( tbl_row == 0 || (tbl_row && !(tbl_row%2)))
		{
			trow.style.backgroundColor = "#cbccc6";
		}
		else
		{
			trow.style.backgroundColor = "#DFEFE9";	
		}

		cell = trow.insertCell(0);
		cell.innerHTML = tbl_row;
		cell = trow.insertCell(1);
		cell.innerHTML = epcData;
		cell = trow.insertCell(2);
		cell.innerHTML = timeSeen;
		cell = trow.insertCell(3);
		cell.innerHTML = 1;		
	}
	tagCount++;
}

var source;
var isOpenOnce = false;
function startTagInfoSSe()
{
	if (isOpenOnce == true)
	{
		return;
	}
	 //alert("Start SSE now!");
	if(typeof(EventSource) !== "undefined") 
	{
		source = new EventSource("/cgi-bin/taginfo_sse.cgi");

		source.onmessage = function(event) 
		{
			// document.getElementById("result").innerHTML += event.data + "<br>";
			displayTagInfo(event.data);
			
		}
	} else {
		document.getElementById("result").innerHTML = "Sorry, your browser does not support server-sent events...";
	}
	isOpenOnce = true;
}

function stopTagInfoSSe()
{
  // alert("Close SSE now!");
	if (isOpenOnce == true) 
	{
		source.close();
	}
	isOpenOnce = false;
}

function readTagInfoOnce()
{
	if (isOpenOnce == true)
	{
		return;
	}
}

  // tablea.rows[5].cells[10].innerHTML='&#128225;<b>ANT</b>';
  //alert("Table row inserted end!");
  //var tagInfo = '0123456789abcdef01234567~Feb 2 2020 12:30:14';
  //var tagInfo1 = '0123456789abcdef01234567~Feb 2 2020 12:30:24';
  //var tagInfo2 = '0123456789abcdef01234568~Feb 2 2020 12:30:34';
  //var tagInfo3 = '0123456789abcdef01234568~Feb 2 2020 12:30:44'; 
  //var tagInfo4 = '0123456789abcdef01234567~Feb 2 2020 12:30:54';  
  //displayTagInfo(tagInfo);
  //displayTagInfo(tagInfo1);
  //displayTagInfo(tagInfo2);
 //displayTagInfo(tagInfo3); 
 //displayTagInfo(tagInfo4);   
  //loadAntennaMap();
  //startTagInfoSSe();
</script>

</body>
</html>

